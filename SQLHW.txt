-- #1a
SELECT first_name, last_name
FROM `actor`;

-- #1b
SELECT UPPER(CONCAT(first_name, ' ', last_name)) 
AS ActorName
FROM `actor`;

-- #2a
SELECT actor_id, first_name, last_name
FROM `actor` 
WHERE first_name ='joe';

-- #2b
SELECT * 
FROM `actor` 
WHERE last_name 
LIKE '%GEN%';

-- #2c
SELECT * 
FROM `actor` 
WHERE last_name 
LIKE '%LI%'
ORDER BY last_name, first_name;

-- #2d
SELECT country_id, country 
FROM `country`
WHERE country 
IN ('Afghanistan' , 'Bangladesh', 'China');

-- 3a
ALTER TABLE `actor` 
ADD COLUMN middle_name 
VARCHAR(45) 
NULL AFTER first_name;

-- 3b
ALTER TABLE `actor` 
CHANGE COLUMN middle_name middle_name 
BLOB NULL DEFAULT NULL;

-- 3c
ALTER TABLE `actor` 
DROP COLUMN middle_name;

-- 4a
SELECT DISTINCT last_name, COUNT(last_name) 
AS 'name_count' 
FROM `actor` 
GROUP BY last_name;

-- 4b
SELECT DISTINCT last_name, COUNT(last_name) 
AS 'name_count' 
FROM `actor` GROUP BY last_name 
HAVING name_count >= 2;

-- 4c
UPDATE `actor` 
SET first_name = 'HARPO' 
WHERE first_name = 'GROUCHO' 
AND last_name = 'WILLIAMS';

-- 5a
SHOW CREATE TABLE sakila.address;

-- 6a
SELECT staff.first_name, staff.last_name, address.address, city.city, country.country
FROM `staff`
JOIN `address` 
ON staff.address_id  = address.address_id 
INNER JOIN city 
ON address.city_id = city.city_id
INNER JOIN country 
ON city.country_id = country.country_id;

-- 6b
SELECT staff.first_name, staff.last_name, SUM(payment.amount) 
AS revenue_received
FROM `staff`
JOIN payment ON staff.staff_id = payment.staff_id
WHERE payment.payment_date 
LIKE '2005-08%'
GROUP BY payment.staff_id;
 
-- 6c
SELECT title, COUNT(actor_id) 
AS number_of_actors 
FROM `film` 
JOIN `film_actor`
ON film.film_id = film_actor.film_id 
GROUP BY title; 

-- 6d
SELECT title, COUNT(inventory_id) 
AS number_of_copies 
FROM `film`
JOIN `inventory` 
ON film.film_id = inventory.film_id 
WHERE title = 'Hunchback Impossible';

-- 6e
SELECT last_name, first_name, SUM(amount) 
AS total_paid 
FROM payment 
JOIN customer ON payment.customer_id = customer.customer_id 
GROUP BY payment.customer_id 
ORDER BY last_name ASC;
 
-- 7a
SELECT title 
FROM film
WHERE language_id 
IN (SELECT language_id 
	FROM language 
	WHERE name = "English" ) AND
	(title LIKE "K%") OR (title LIKE "Q%");
 
-- 7B
SELECT last_name, first_name
FROM actor
WHERE actor_id 

IN (SELECT actor_id
   
   FROM film_actor
	WHERE film_id 
		
		IN (SELECT film_id
            FROM film
            WHERE title = 'Alone Trip'));


select sakila.film.title FROM sakila.film;

-- 7d Find Family Films
SELECT film.film_id, film.title
FROM film 
JOIN film_category ON (film.film_id = film_category.film_id)
JOIN category ON (film_category.category_id = category.category_id)
WHERE category.name = 'Family';

-- Alternate and awkward way of doing the same thing using sub-selects
SELECT film.film_id, film.title FROM `film`
WHERE film.film_id IN (
	SELECT film_category.film_id FROM film_category
	WHERE film_category.category_id 
	IN (
		SELECT category.category_id FROM category WHERE category.name = 'Family'
	)
);



IN (
	SELECT film_id 
	FROM film_category 
	WHERE category_id 
		
		IN (
				SELECT category_id 
				FROM category 
				WHERE NAME = 'Family'
			)
	)
;

-- 7e
-- SELECT film.title, COUNT() 
-- AS 'rent_count' 
-- FROM film, inventory, rental
-- WHERE film.film_id = inventory.film_id AND rental.inventory_id = inventory.inventory_id 
-- GROUP BY inventory.film_id 
-- ORDER BY COUNT () DESC, film.title ASC;

SELECT i.film_id, f.title, COUNT(r.inventory_id)
FROM inventory i
JOIN rental r
ON i.inventory_id = r.inventory_id
JOIN film f
ON i.film_id = f.film_id
GROUP BY r.inventory_id
ORDER BY COUNT(r.inventory_id) DESC;

-- 7f
SELECT store.store_id, SUM(amount) 
AS revenue 
FROM store
JOIN staff 
ON store.store_id = staff.store_id  
JOIN payment ON payment.staff_id = staff.staff_id 
GROUP BY store.store_id;

-- 7g
SELECT store.store_id, city.city, country.country 
FROM store 
JOIN address ON store.address_id = address.address_id 
JOIN city ON address.city_id = city.city_id 
JOIN country ON city.country_id = country.country_id;

-- 7h
SELECT NAME, SUM(p.amount) AS gross_revenue 
FROM category c 
JOIN film_category fc ON fc.category_id = c.category_id 
JOIN inventory i ON i.film_id = fc.film_id 
JOIN rental r ON r.inventory_id = i.inventory_id 
RIGHT JOIN payment p ON p.rental_id = r.rental_id
GROUP BY NAME ORDER BY gross_revenue DESC LIMIT 5;

-- 8a
DROP VIEW IF EXISTS top_five_genres; 
CREATE VIEW top_five_grossing_genres AS 
SELECT NAME, SUM(p.amount) AS gross_revenue 
FROM category c 
JOIN film_category fc ON fc.category_id = c.category_id 
JOIN inventory i ON i.film_id = fc.film_id 
JOIN rental r ON r.inventory_id = i.inventory_id 
RIGHT JOIN payment p ON p.rental_id = r.rental_id
GROUP BY NAME ORDER BY gross_revenue DESC LIMIT 5;

-- 8b
SELECT * 
FROM `top_five_grossing_genres`;

-- 8c
DROP VIEW `top_five_grossing_genres`;



